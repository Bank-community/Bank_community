<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCF Template Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Tiro+Devanagari+Hindi&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Poppins', 'Tiro Devanagari Hindi', sans-serif; background-color: #f0fdf4; }
        .canvas-container {
            width: 100%; max-width: 350px; margin: 0 auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border-radius: 0.5rem; overflow: hidden;
            background-color: #e5e7eb; position: relative;
            min-height: 250px; display: flex; align-items: center; justify-content: center;
            border: 4px solid #fff;
        }
        canvas { width: 100% !important; height: auto !important; display: block; }
        .control-btn:active { transform: scale(0.95); }
        
        /* Template Selection Styles */
        .template-option {
            transition: all 0.2s;
            border: 3px solid transparent;
        }
        .template-option.selected {
            border-color: #16a34a; /* Green border for selected */
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-6 px-3">

    <header class="text-center mb-5">
        <h1 class="text-3xl font-bold text-gray-800 mb-1">TCF Template</h1>
        <p class="text-green-600 font-bold text-lg">Happy New Year 2026</p>
    </header>

    <div class="bg-white p-5 rounded-2xl shadow-xl w-full max-w-lg border border-gray-100">
        
        <!-- Preview -->
        <div class="mb-6 relative">
            <h2 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 text-center">Preview</h2>
            <div id="canvasWrapper" class="canvas-container">
                <div id="loadingMessage" class="flex flex-col items-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mb-2"></div>
                    <span class="text-gray-500 text-xs">Loading Template...</span>
                </div>
                <canvas id="posterCanvas" class="hidden"></canvas>
            </div>
        </div>

        <!-- NEW: Template Selection Section -->
        <div class="mb-6">
            <label class="block text-xs font-bold text-gray-600 uppercase mb-2">Select Design</label>
            <div class="grid grid-cols-3 gap-3">
                <!-- Templates generated by JS -->
                <div onclick="changeTemplate(0)" class="template-option selected cursor-pointer rounded-lg overflow-hidden bg-gray-100 relative h-20" id="tmpl-0">
                    <img src="https://ik.imagekit.io/kdtvm0r78/1000120033_QsdZAGDRI.png" class="w-full h-full object-cover opacity-80 hover:opacity-100">
                    <div class="absolute bottom-0 w-full bg-black bg-opacity-50 text-white text-[10px] text-center py-1">Design 1</div>
                </div>
                <div onclick="changeTemplate(1)" class="template-option cursor-pointer rounded-lg overflow-hidden bg-gray-100 relative h-20" id="tmpl-1">
                    <img src="https://ik.imagekit.io/kdtvm0r78/1000120027_cgCObjI8l.png" class="w-full h-full object-cover opacity-80 hover:opacity-100">
                    <div class="absolute bottom-0 w-full bg-black bg-opacity-50 text-white text-[10px] text-center py-1">Design 2</div>
                </div>
                <div onclick="changeTemplate(2)" class="template-option cursor-pointer rounded-lg overflow-hidden bg-gray-100 relative h-20" id="tmpl-2">
                    <img src="https://ik.imagekit.io/kdtvm0r78/1000120061_UlJ2-DshY.png" class="w-full h-full object-cover opacity-80 hover:opacity-100">
                    <div class="absolute bottom-0 w-full bg-black bg-opacity-50 text-white text-[10px] text-center py-1">Design 3</div>
                </div>
            </div>
        </div>

        <!-- Inputs -->
        <div class="space-y-4 mb-6">
            <div class="relative">
                <input type="file" id="userImageInput" accept="image/*" class="hidden" />
                <label for="userImageInput" class="flex items-center justify-center w-full p-3 bg-blue-50 text-blue-700 rounded-lg border-2 border-dashed border-blue-200 cursor-pointer hover:bg-blue-100 transition">
                    <i class="fas fa-camera mr-2"></i> <span id="uploadText">Upload Photo</span>
                </label>
            </div>

            <div>
                <input type="text" id="nameInput" placeholder="Enter Member Name" 
                    class="w-full px-4 py-3 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none transition"
                />
                
                <!-- Text Position Controls -->
                <div class="flex justify-between items-center mt-2 px-1">
                    <span class="text-xs font-bold text-gray-400 uppercase">Move Name:</span>
                    <div class="flex gap-2">
                        <button onclick="moveText(-1)" class="control-btn bg-gray-100 text-gray-600 px-3 py-1 rounded shadow text-xs font-bold hover:bg-gray-200">
                            <i class="fas fa-arrow-up"></i> Up
                        </button>
                        <button onclick="moveText(1)" class="control-btn bg-gray-100 text-gray-600 px-3 py-1 rounded shadow text-xs font-bold hover:bg-gray-200">
                            Down <i class="fas fa-arrow-down"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Photo Controls -->
        <div id="adjustmentPanel" class="hidden bg-gray-50 p-4 rounded-xl border border-gray-200 mb-6">
            <div class="flex justify-between items-center mb-3 border-b border-gray-200 pb-2">
                <label class="text-xs font-bold text-gray-600 uppercase">Adjust Photo</label>
                <button onclick="resetAdjustments()" class="text-xs text-red-500 font-bold">RESET</button>
            </div>
            <div class="grid grid-cols-2 gap-6">
                <!-- Zoom -->
                <div class="flex flex-col items-center justify-center">
                    <span class="text-xs text-gray-400 font-bold mb-2 uppercase">Zoom</span>
                    <div class="flex items-center gap-3">
                        <button onclick="adjustZoom(-0.05)" class="control-btn w-10 h-10 bg-white rounded-full shadow border border-gray-200 text-xl font-bold flex items-center justify-center"><i class="fas fa-minus"></i></button>
                        <button onclick="adjustZoom(0.05)" class="control-btn w-10 h-10 bg-blue-600 rounded-full shadow-lg text-white text-xl font-bold flex items-center justify-center"><i class="fas fa-plus"></i></button>
                    </div>
                </div>
                <!-- Move -->
                <div class="flex flex-col items-center">
                    <span class="text-xs text-gray-400 font-bold mb-2 uppercase">Move</span>
                    <div class="grid grid-cols-3 gap-1">
                        <div></div><button onclick="adjustPan(0, -10)" class="control-btn w-8 h-8 bg-white rounded shadow flex items-center justify-center"><i class="fas fa-chevron-up"></i></button><div></div>
                        <button onclick="adjustPan(-10, 0)" class="control-btn w-8 h-8 bg-white rounded shadow flex items-center justify-center"><i class="fas fa-chevron-left"></i></button>
                        <div class="w-8 h-8 flex items-center justify-center text-gray-300"><i class="fas fa-arrows-alt"></i></div>
                        <button onclick="adjustPan(10, 0)" class="control-btn w-8 h-8 bg-white rounded shadow flex items-center justify-center"><i class="fas fa-chevron-right"></i></button>
                        <div></div><button onclick="adjustPan(0, 10)" class="control-btn w-8 h-8 bg-white rounded shadow flex items-center justify-center"><i class="fas fa-chevron-down"></i></button><div></div>
                    </div>
                </div>
            </div>
        </div>

        <button id="downloadBtn" onclick="downloadPoster()" disabled class="w-full bg-gray-300 text-gray-500 font-bold py-4 px-4 rounded-xl shadow-sm transition duration-300 flex items-center justify-center gap-2 cursor-not-allowed text-lg">
            <i class="fas fa-download"></i> Download Image
        </button>
    </div>

    <script>
        // --- TEMPLATE CONFIGURATION ---
        const TEMPLATES = [
            {
                url: "https://ik.imagekit.io/kdtvm0r78/1000120033_QsdZAGDRI.png",
                textYPercent: 0.82 // Default position for Template 1
            },
            {
                url: "https://ik.imagekit.io/kdtvm0r78/1000120027_cgCObjI8l.png",
                textYPercent: 0.82 // Default position for Template 2
            },
            {
                url: "https://ik.imagekit.io/kdtvm0r78/1000120061_UlJ2-DshY.png",
                textYPercent: 0.82 // Default position for Template 3
            }
        ];

        // Global Text Config
        const TEXT_STYLE = {
            color: "#FFFFFF",
            fontSizePercent: 0.045, 
            fontFamily: "'Tiro Devanagari Hindi', 'Poppins', sans-serif"
        };

        // --- DOM ELEMENTS ---
        const canvas = document.getElementById('posterCanvas');
        const ctx = canvas.getContext('2d');
        const userImageInput = document.getElementById('userImageInput');
        const nameInput = document.getElementById('nameInput');
        const downloadBtn = document.getElementById('downloadBtn');
        const adjustmentPanel = document.getElementById('adjustmentPanel');
        const loadingMessage = document.getElementById('loadingMessage');

        // --- STATE ---
        let currentTemplateIndex = 0;
        let templateImg = new Image();
        let userImg = null;
        let userName = "";
        
        // Photo Transform State
        let currentScale = 1;
        let currentOffsetX = 0;
        let currentOffsetY = 0;
        let baseDrawWidth, baseDrawHeight, baseOffsetX, baseOffsetY;
        
        // Text Adjustment State
        let textVerticalOffset = 0;

        // --- INITIALIZATION ---
        function loadTemplate(index) {
            // Show Loader
            loadingMessage.classList.remove('hidden');
            canvas.classList.add('hidden');
            
            // Update UI Selection
            document.querySelectorAll('.template-option').forEach((el, i) => {
                if (i === index) el.classList.add('selected');
                else el.classList.remove('selected');
            });

            currentTemplateIndex = index;
            templateImg = new Image();
            templateImg.crossOrigin = "anonymous";
            templateImg.src = TEMPLATES[index].url;

            templateImg.onload = function() {
                canvas.width = templateImg.naturalWidth;
                canvas.height = templateImg.naturalHeight;
                
                loadingMessage.classList.add('hidden');
                canvas.classList.remove('hidden');
                
                // Recalculate fit if user image exists (because template aspect ratio might change)
                if (userImg) calculateBaseFit();
                
                drawCanvas();
                enableDownloadButton();
            };
        }

        // Load default template
        loadTemplate(0);

        // --- EVENT HANDLERS ---
        
        window.changeTemplate = function(index) {
            if (currentTemplateIndex === index) return;
            loadTemplate(index);
        }

        userImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            document.getElementById('uploadText').innerText = "Change Photo";
            const reader = new FileReader();
            reader.onload = function(event) {
                const img = new Image();
                img.onload = function() {
                    userImg = img;
                    adjustmentPanel.classList.remove('hidden'); 
                    calculateBaseFit();
                    resetAdjustments(false); // Reset Zoom/Pan on new photo
                    drawCanvas();
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        });

        nameInput.addEventListener('input', (e) => { userName = e.target.value; drawCanvas(); });
        
        // --- CONTROLS ---
        window.moveText = function(direction) {
            const step = canvas.height * 0.005; 
            textVerticalOffset += direction * step;
            drawCanvas();
        }

        window.adjustZoom = function(delta) {
            if (!userImg) return;
            currentScale += delta;
            if (currentScale < 0.1) currentScale = 0.1;
            drawCanvas();
        }

        window.adjustPan = function(x, y) {
            if (!userImg) return;
            const moveFactor = canvas.width / 400; 
            currentOffsetX += x * moveFactor * 1; 
            currentOffsetY += y * moveFactor * 1;
            drawCanvas();
        }

        window.resetAdjustments = function(redraw = true) {
            currentScale = 1;
            currentOffsetX = 0;
            currentOffsetY = 0;
            textVerticalOffset = 0;
            if(redraw) drawCanvas();
        }

        function calculateBaseFit() {
            if (!userImg) return;
            const canvasRatio = canvas.width / canvas.height;
            const imgRatio = userImg.width / userImg.height;

            if (imgRatio > canvasRatio) {
                baseDrawWidth = canvas.width;
                baseDrawHeight = userImg.height * (canvas.width / userImg.width);
                baseOffsetX = 0;
                baseOffsetY = (canvas.height - baseDrawHeight) / 2;
            } else {
                baseDrawHeight = canvas.height;
                baseDrawWidth = userImg.width * (canvas.height / userImg.width);
                baseOffsetX = (canvas.width - baseDrawWidth) / 2;
                baseOffsetY = 0;
            }
        }

        function drawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#ffffff"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 1. Photo Layer
            if (userImg) {
                ctx.save();
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                ctx.translate(centerX, centerY);
                ctx.scale(currentScale, currentScale);
                ctx.translate(-centerX, -centerY);
                ctx.drawImage(userImg, baseOffsetX + currentOffsetX, baseOffsetY + currentOffsetY, baseDrawWidth, baseDrawHeight);
                ctx.restore();
            } else {
                ctx.fillStyle = "#f3f4f6";
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "#9ca3af";
                ctx.font = `bold ${canvas.width*0.05}px sans-serif`;
                ctx.textAlign = "center";
                ctx.fillText("No Image", canvas.width/2, canvas.height/2);
            }

            // 2. Template Layer
            ctx.drawImage(templateImg, 0, 0);

            // 3. Name Layer
            if (userName) {
                const fontSize = canvas.height * TEXT_STYLE.fontSizePercent;
                ctx.font = `700 ${fontSize}px ${TEXT_STYLE.fontFamily}`;
                ctx.fillStyle = TEXT_STYLE.color;
                ctx.textAlign = "center";
                ctx.shadowColor = "rgba(0,0,0,0.8)";
                ctx.shadowBlur = 4;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;

                const xPos = canvas.width / 2;
                
                // Get Base Position from current Template Config
                const basePercent = TEMPLATES[currentTemplateIndex].textYPercent;
                const yPos = (canvas.height * basePercent) + textVerticalOffset;

                ctx.fillText(userName, xPos, yPos);
                ctx.shadowColor = "transparent";
            }
        }

        function enableDownloadButton() {
            downloadBtn.disabled = false;
            downloadBtn.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
            downloadBtn.classList.add('bg-green-600', 'text-white', 'hover:bg-green-700', 'active:scale-95');
        }

        function downloadPoster() {
            if (!userImg && !userName) {
               if(!confirm("Download empty template?")) return;
            }
            const link = document.createElement('a');
            const cleanName = userName.replace(/[^a-zA-Z0-9 ]/g, "").trim();
            const templateNum = currentTemplateIndex + 1;
            link.download = (cleanName ? cleanName : 'TCF_Poster') + `_Design${templateNum}.png`;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
        }
    </script>
</body>
</html>


